<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Di√°rio de Classe de Lucimeiri</title>
    
    <!-- √çcones e Manifest -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgcng9IjIwIiBmaWxsPSIjNGEwNDFhIi8+PHRleHQgeD0iNTAiIHk9IjY1IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iNDAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+RENMPC90ZXh0Pjwvc3ZnPg==">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4a041a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').catch(err => console.log("Erro SW:", err));
      }
    </script>
    
    <style>
        :root { --sidebar: #4a041a; --bg: #fff5f8; --p: #e91e63; --p-light: #fce4ec; --txt: #4a1a2c; --err: #d81b60; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100vh; font-family: 'Inter', sans-serif; overflow: hidden; color: var(--txt); }
        .hidden { display: none !important; }
        #auth-screen { position: fixed; inset: 0; background: var(--sidebar); display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .auth-card { background: white; padding: 30px; border-radius: 20px; width: 340px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); text-align: center; }
        .auth-btn { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--p); color: white; font-weight: 800; cursor: pointer; margin-top: 10px; }
        .auth-card input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #f8bbd0; border-radius: 10px; box-sizing: border-box; }
        #app { display: flex; width: 100vw; height: 100vh; }
        .col-1 { width: 240px; background: var(--sidebar); color: white; flex-shrink: 0; display: flex; flex-direction: column; }
        .turno-select { width: 90%; margin: 10px auto; padding: 10px; background: #6b0b2b; color: white; border-radius: 10px; border: none; font-weight: 600; }
        .turma-badge { background: rgba(255,255,255,0.1); padding: 10px; margin: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 13px; transition: 0.2s; }
        .turma-badge.active { background: var(--p); font-weight: 800; }
        
        .col-2 { width: 350px; background: white; border-right: 1px solid #f8bbd0; display: flex; flex-direction: column; }
        
        .aluno-card { 
            background: var(--p-light); 
            padding: 8px; 
            margin: 4px 10px; 
            border-radius: 8px; 
            border: 1.5px solid #f06292; 
            border-left: 5px solid #d81b60; 
            cursor: pointer; 
            font-size: 10px; 
            font-weight: 700; 
            position: relative; 
            transition: 0.2s;
        }
        .aluno-card:hover { border-color: var(--p); background: #fff; }
        .aluno-card.active { background: var(--p); color: #fff; border-color: var(--sidebar); }
        
        .col-3 { flex: 1; background: var(--bg); display: flex; flex-direction: column; overflow: hidden; }
        .header-main { padding: 15px 20px; border-bottom: 1px solid #f8bbd0; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .grid-bim { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; overflow-y: auto; flex: 1; }
        .card-bim { background: white; padding: 15px; border-radius: 15px; border-top: 4px solid var(--p); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .btn-add { background: var(--sidebar); color: white; border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer; font-size: 11px; font-weight: bold; }
        
        #busca { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #f8bbd0; box-sizing: border-box; }

        #boletim-impresso { display: none; }
        @media print {
            @page { size: portrait; margin: 1cm; }
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
            #boletim-impresso { display: block !important; width: 100%; color: black; }
            table { width: 100%; border-collapse: collapse; margin-top: 15px; }
            th, td { border: 1px solid #000; padding: 8px; text-align: center; font-size: 12px; }
            th { background: #f2f2f2 !important; }
        }
    </style>
</head>
<body>
    <div id="auth-screen">
        <div id="auth-login" class="auth-card">
            <h2 style="color: var(--sidebar)">Di√°rio de Classe</h2>
            <input type="text" id="l-user" placeholder="Usu√°rio">
            <input type="password" id="l-pass" placeholder="Senha">
            <button class="auth-btn" onclick="execLogin()">Entrar</button>
            <p onclick="showAuth('auth-reg')" style="cursor:pointer; font-size:12px; color:var(--p); margin-top:15px">Cadastrar</p>
            <p onclick="showAuth('auth-rec')" style="cursor:pointer; font-size:12px; color:#9c27b0; margin-top:10px">Recuperar Senha</p>
        </div>
        <div id="auth-reg" class="auth-card hidden">
            <h2 style="color: var(--sidebar)">Novo Registro</h2>
            <input type="text" id="r-user" placeholder="Usu√°rio">
            <input type="password" id="r-pass" placeholder="Senha">
            <input type="text" id="r-phrase" placeholder="Pergunta Secreta">
            <input type="text" id="r-ans" placeholder="Resposta">
            <button class="auth-btn" onclick="execReg()">Salvar</button>
            <p onclick="showAuth('auth-login')" style="cursor:pointer; font-size:12px; margin-top:15px">Voltar</p>
        </div>
        <div id="auth-rec" class="auth-card hidden">
            <h2 style="color: var(--sidebar)">Recuperar</h2>
            <div id="rec-step1">
                <input type="text" id="rec-user-find" placeholder="Seu Usu√°rio">
                <button class="auth-btn" onclick="findUser()">Ver Pergunta</button>
            </div>
            <div id="rec-step2" class="hidden">
                <p id="display-phrase" style="font-weight:bold; color:var(--p)"></p>
                <input type="text" id="rec-ans-check" placeholder="Sua Resposta">
                <input type="password" id="rec-new-pass" placeholder="Nova Senha">
                <button class="auth-btn" onclick="execRec()">Redefinir</button>
            </div>
            <p onclick="location.reload()" style="cursor:pointer; font-size:12px; margin-top:15px">Cancelar</p>
        </div>
    </div>

    <div id="app" class="hidden">
        <div class="col-1 no-print">
            <div style="padding:20px; font-weight:bold; text-align:center; border-bottom:1px solid rgba(255,255,255,0.1)">LUCIMEIRI</div>
            <select id="sel-turno" onchange="renderTurmas()" class="turno-select">
                <option value="Matutino">‚òÄÔ∏è Matutino</option>
                <option value="Vespertino">üå§Ô∏è Vespertino</option>
                <option value="Noturno">üåô Noturno</option>
            </select>
            <div style="padding:10px"><button onclick="addTurma()" class="btn-add" style="width:100%; background:white; color:var(--sidebar)">+ Turma</button></div>
            <div id="lista-turmas"></div>
        </div>
        <div class="col-2 no-print">
            <div style="padding:15px; border-bottom:1px solid #f8bbd0">
                <button onclick="addAluno()" class="btn-add" style="width:100%; margin-bottom:10px">CADASTRAR ALUNO</button>
                <div style="width:100%"><input type="text" id="busca" placeholder="Filtrar aluno..." onkeyup="filtrar()"></div>
            </div>
            <div id="lista-alunos" style="overflow-y:auto; flex:1"></div>
        </div>
        <div class="col-3" id="print-area">
            <div id="topo-notas" class="hidden header-main no-print">
                <div style="display:flex; align-items:center; gap:15px">
                    <b id="nome-aluno-header" style="color: var(--sidebar); font-size: 16px"></b>
                    <select id="sel-mat" onchange="renderNotas()" style="padding:8px; border-radius:8px; border:1px solid #f8bbd0; font-weight:700; color: var(--p)"></select>
                    <button onclick="addMateria()" class="btn-add">+ MAT√âRIA</button>
                    <button onclick="delMateria()" style="background:none; border:none; color:var(--err); cursor:pointer">üóëÔ∏è</button>
                </div>
                <div style="display:flex; gap:10px">
                    <button onclick="window.print()" style="background:#000; color:#fff; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; font-weight:800;">IMPRIMIR</button>
                    <button onclick="execSair()" style="background:#fff; color:var(--err); border:1px solid var(--err); padding:10px; border-radius:8px; cursor:pointer;">Sair</button>
                </div>
            </div>
            <div id="workspace-notas" class="hidden" style="flex:1; display:flex; flex-direction:column">
                <div class="grid-bim no-print" id="grid-notas"></div>
                <div id="boletim-impresso"></div>
                <div class="no-print" style="padding:20px; background:#fff; border-top:1px solid #f8bbd0; text-align:right">
                    <div id="total-anual-txt" style="font-weight:800; font-size: 22px; color: var(--sidebar)"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    let db = JSON.parse(localStorage.getItem('edu_db_vfinal_lucimeiri')) || { turmas: [], auth: null };
    let cur = { t: null, a: null };
    const save = () => localStorage.setItem('edu_db_vfinal_lucimeiri', JSON.stringify(db));
    
    function showAuth(id) { document.querySelectorAll('.auth-card').forEach(c => c.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    
    function execReg() {
        const u=document.getElementById('r-user').value, p=document.getElementById('r-pass').value, f=document.getElementById('r-phrase').value, a=document.getElementById('r-ans').value;
        if(u && p) { 
            if(db.auth && u === db.auth.u) { alert("Este usu√°rio j√° est√° cadastrado!"); return; }
            db.auth={u,p,f,a}; save(); alert("Cadastro realizado!"); showAuth('auth-login'); 
        }
    }
    
    function execLogin() {
        const u=document.getElementById('l-user').value, p=document.getElementById('l-pass').value;
        if(db.auth && u===db.auth.u && p===db.auth.p) { 
            document.getElementById('auth-screen').classList.add('hidden'); 
            document.getElementById('app').classList.remove('hidden'); 
            renderTurmas();
            setTimeout(() => alert("Deus aben√ßoe cada dia voc√™"), 500);
        }
        else alert("Acesso Negado.");
    }

    function execSair() {
        alert("Parabens, diario atualizado com sucesso. Nunca se esque√ßa o quanto voc√™ √© especial!");
        location.reload();
    }

    function findUser() {
        const u = document.getElementById('rec-user-find').value;
        if(db.auth && u === db.auth.u) {
            document.getElementById('rec-step1').classList.add('hidden');
            document.getElementById('rec-step2').classList.remove('hidden');
            document.getElementById('display-phrase').innerText = "Sua Pergunta: " + db.auth.f;
        } else alert("Usu√°rio n√£o encontrado.");
    }

    function execRec() {
        const a = document.getElementById('rec-ans-check').value, np = document.getElementById('rec-new-pass').value;
        if(a.toLowerCase() === db.auth.a.toLowerCase() && np) { db.auth.p = np; save(); alert("Senha Alterada!"); location.reload(); }
        else alert("Resposta Incorreta.");
    }

    function addTurma() { const n=prompt("Nome da Turma:"); if(n) { db.turmas.push({nome:n, turno:document.getElementById('sel-turno').value, materias:[], alunos:[]}); save(); renderTurmas(); } }
    
    function renderTurmas() {
        const t=document.getElementById('sel-turno').value, div=document.getElementById('lista-turmas'); div.innerHTML='';
        const ordenadas = db.turmas.filter(tr => tr.turno === t).sort((a,b) => a.nome.localeCompare(b.nome, undefined, {numeric:true}));
        ordenadas.forEach((tr) => { 
            const idx = db.turmas.indexOf(tr);
            div.innerHTML+=`<div class="turma-badge ${cur.t===idx?'active':''}" onclick="setTurma(${idx})">${tr.nome}</div>`; 
        });
    }

    function setTurma(i) { cur.t=i; cur.a=null; renderTurmas(); renderAlunos(); }

    function addAluno() { 
        if(cur.t === null) { alert("Por favor, selecione uma TURMA primeiro na lista √† esquerda!"); return; }
        const n=prompt("Nome do Aluno:"); 
        if(n) { db.turmas[cur.t].alunos.push({nome:n, notas:{}}); save(); renderAlunos(); } 
    }

    function renderAlunos() {
        const div=document.getElementById('lista-alunos'); div.innerHTML=''; if(cur.t===null) return;
        const ordenados = [...db.turmas[cur.t].alunos].sort((a,b) => a.nome.localeCompare(b.nome));
        ordenados.forEach((al) => { 
            const idx = db.turmas[cur.t].alunos.indexOf(al);
            div.innerHTML+=`<div class="aluno-card ${cur.a===idx?'active':''}" onclick="setAluno(${idx})">${al.nome.toUpperCase()}</div>`; 
        });
    }

    function setAluno(i) { cur.a=i; document.getElementById('nome-aluno-header').innerText=db.turmas[cur.t].alunos[i].nome; document.getElementById('topo-notas').classList.remove('hidden'); document.getElementById('workspace-notas').classList.remove('hidden'); renderAlunos(); atualizarMaterias(); }
    
    function addMateria() { const n=prompt("Mat√©ria:"); if(n) { db.turmas[cur.t].materias.push(n); save(); atualizarMaterias(); } }
    
    function atualizarMaterias() { 
        const sel=document.getElementById('sel-mat'); 
        db.turmas[cur.t].materias.sort((a,b) => a.localeCompare(b));
        sel.innerHTML=db.turmas[cur.t].materias.map(m=>`<option value="${m}">${m}</option>`).join(''); 
        renderNotas(); 
    }
    
    function delMateria() { if(confirm("Excluir disciplina?")) { db.turmas[cur.t].materias=db.turmas[cur.t].materias.filter(x=>x!==document.getElementById('sel-mat').value); save(); atualizarMaterias(); } }
    
    function renderNotas() {
        const m=document.getElementById('sel-mat').value; if(!m) return;
        const al=db.turmas[cur.t].alunos[cur.a]; let total=0; document.getElementById('grid-notas').innerHTML='';
        for(let b=1; b<=4; b++) {
            const key=`${m}_b${b}`, notas=al.notas[key] || []; const soma=notas.reduce((s,n)=>s+parseFloat(n.v),0); total+=soma;
            document.getElementById('grid-notas').innerHTML+=`<div class="card-bim"><b>${b}¬∫ BIM</b> <button onclick="addNota('${key}')" class="btn-add">+</button><div style="font-size:12px; margin:10px 0; height:60px; overflow-y:auto">${notas.map((n, ni)=>`<div>${n.d}: ${n.v} <i onclick="delNota('${key}',${ni})" style="color:red; cursor:pointer">x</i></div>`).join('')}</div><div style="text-align:right; font-weight:800; color:var(--p)">SOMA: ${soma.toFixed(1)}/25</div></div>`;
        }
        document.getElementById('total-anual-txt').innerText=`TOTAL: ${total.toFixed(1)} / 100`;
        prepararBoletim();
    }

    function addNota(key) {
        const al=db.turmas[cur.t].alunos[cur.a]; if(!al.notas[key]) al.notas[key]=[]; 
        const soma=al.notas[key].reduce((s,n)=>s+parseFloat(n.v),0);
        const d=prompt("Avalia√ß√£o:"); const v=parseFloat(prompt("Nota:"));
        if(d && !isNaN(v)) { if((soma+v) <= 25.1) { al.notas[key].push({d, v}); save(); renderNotas(); } else alert("Valor excedido a 25 pontos!"); }
    }

    function delNota(key, ni) { if(confirm("Excluir nota?")) { db.turmas[cur.t].alunos[cur.a].notas[key].splice(ni,1); save(); renderNotas(); } }
    
    function filtrar() { const v=document.getElementById('busca').value.toLowerCase(); document.querySelectorAll('.aluno-card').forEach(e=>e.style.display=e.innerText.toLowerCase().includes(v)?'block':'none'); }
    
    function prepararBoletim() {
        const al = db.turmas[cur.t].alunos[cur.a], tr = db.turmas[cur.t];
        let html = `<h2>BOLETIM - ${al.nome.toUpperCase()}</h2><p style="text-align:center">PROFESSORA: LUCIMEIRI</p>
                    <table><thead><tr><th>MAT√âRIA</th><th>1¬∫B</th><th>2¬∫B</th><th>3¬∫B</th><th>4¬∫B</th><th>TOTAL</th><th>SITUA√á√ÉO</th></tr></thead><tbody>`;
        tr.materias.forEach(m => {
            const b1=(al.notas[m+'_b1']||[]).reduce((s,n)=>s+n.v,0), b2=(al.notas[m+'_b2']||[]).reduce((s,n)=>s+n.v,0);
            const b3=(al.notas[m+'_b3']||[]).reduce((s,n)=>s+n.v,0), b4=(al.notas[m+'_b4']||[]).reduce((s,n)=>s+n.v,0);
            const total = b1+b2+b3+b4;
            html += `<tr><td>${m.toUpperCase()}</td><td>${b1.toFixed(1)}</td><td>${b2.toFixed(1)}</td><td>${b3.toFixed(1)}</td><td>${b4.toFixed(1)}</td><td><b>${total.toFixed(1)}</b></td><td>${total>=70?'APROVADO':'REPROVADO'}</td></tr>`;
        });
        document.getElementById('boletim-impresso').innerHTML = html + `</tbody></table>`;
    }

    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js').catch(()=>{}); }
    window.onload = () => { showAuth('auth-login'); };
</script>
</body>
</html>



