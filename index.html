<!DOCTYPE html>
<html lang="pt-br">
<head>

    <!-- √çcone DCL (Quadrado rosa com letras brancas) -->
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgcng9IjIwIiBmaWxsPSIjZTkxZTYzIi8+PHRleHQgeD0iNTAiIHk9IjY1IiBmaWxsPSJ3aGl0ZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQ1IiBmb250LXdlaWdodD0iYm9sZCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+RENMPC90ZXh0Pjwvc3ZnPg==">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgcng9IjIwIiBmaWxsPSIjZTkxZTYzIi8+PHRleHQgeD0iNTAiIHk9IjY1IiBmaWxsPSJ3aGl0ZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQ1IiBmb250LXdlaWdodD0iYm9sZCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+RENMPC90ZXh0Pjwvc3ZnPg==">

    <link rel="manifest" href="manifest.json">

    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Di√°rio de Classe de Lucimeiri üë†</title>
    <style>
        :root { --sidebar: #4a041a; --bg: #fff5f8; --p: #e91e63; --p-light: #fce4ec; --txt: #4a1a2c; --err: #d81b60; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100vh; font-family: 'Inter', sans-serif; overflow: hidden; color: var(--txt); }
        .hidden { display: none !important; }
        #auth-screen { position: fixed; inset: 0; background: var(--sidebar); display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .auth-card { background: white; padding: 30px; border-radius: 20px; width: 340px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); text-align: center; }
        .auth-btn { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--p); color: white; font-weight: 800; cursor: pointer; margin-top: 10px; }
        .auth-card input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #f8bbd0; border-radius: 10px; box-sizing: border-box; }
        #app { display: flex; width: 100vw; height: 100vh; }
        .col-1 { width: 240px; background: var(--sidebar); color: white; flex-shrink: 0; display: flex; flex-direction: column; }
        .turno-select { width: 90%; margin: 10px auto; padding: 10px; background: #6b0b2b; color: white; border-radius: 10px; border: none; font-weight: 600; }
        .turma-badge { background: rgba(255,255,255,0.1); padding: 10px; margin: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 13px; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; }
        .turma-badge.active { background: var(--p); font-weight: 800; }
        .col-2 { width: 350px; background: white; border-right: 1px solid #f8bbd0; display: flex; flex-direction: column; }
        .aluno-card { background: var(--p-light); padding: 8px; margin: 4px 10px; border-radius: 8px; border: 1.5px solid #f06292; border-left: 5px solid #d81b60; cursor: pointer; font-size: 10px; font-weight: 700; position: relative; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; }
        .aluno-card.active { background: var(--p); color: #fff; border-color: var(--sidebar); }
        .col-3 { flex: 1; background: var(--bg); display: flex; flex-direction: column; overflow: hidden; }
        .header-main { padding: 15px 20px; border-bottom: 1px solid #f8bbd0; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .grid-bim { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; overflow-y: auto; flex: 1; }
        .card-bim { background: white; padding: 15px; border-radius: 15px; border-top: 4px solid var(--p); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .btn-add { background: var(--sidebar); color: white; border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer; font-size: 11px; font-weight: bold; }
        #busca { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #f8bbd0; box-sizing: border-box; }
        .btn-bkp { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; padding: 5px; cursor: pointer; font-size: 10px; margin: 2px 10px; }
        #boletim-impresso { display: none; }
        @media print {
            @page { size: portrait; margin: 1cm; }
            body * { visibility: hidden; }
            #boletim-impresso, #boletim-impresso * { visibility: visible; }
            #boletim-impresso { position: absolute; left: 0; top: 0; width: 100%; display: block !important; color: black; }
            table { width: 100%; border-collapse: collapse; margin-top: 15px; }
            th, td { border: 1px solid #000; padding: 8px; text-align: center; font-size: 12px; }
        }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div id="auth-login" class="auth-card">
            <h2 style="color: var(--sidebar)">Di√°rio de Classe üë†</h2>
            <input type="text" id="l-user" placeholder="Usu√°rio">
            <input type="password" id="l-pass" placeholder="Senha">
            <button class="auth-btn" onclick="execLogin()">Entrar</button>
            <p onclick="showAuth('auth-reg')" style="cursor:pointer; font-size:12px; color:var(--p); margin-top:15px">Cadastrar</p>
            <p onclick="showAuth('auth-rec')" style="cursor:pointer; font-size:12px; color:#9c27b0; margin-top:10px">Recuperar Senha</p>
        </div>
        <div id="auth-reg" class="auth-card hidden">
            <h2 style="color: var(--sidebar)">Novo Registro</h2>
            <input type="text" id="r-user" placeholder="Usu√°rio">
            <input type="password" id="r-pass" placeholder="Senha">
            <input type="text" id="r-phrase" placeholder="Pergunta Secreta">
            <input type="text" id="r-ans" placeholder="Resposta">
            <button class="auth-btn" onclick="execReg()">Salvar</button>
            <p onclick="showAuth('auth-login')" style="cursor:pointer; font-size:12px; margin-top:15px">Voltar</p>
        </div>
        <div id="auth-rec" class="auth-card hidden">
            <h2 style="color: var(--sidebar)">Recuperar</h2>
            <div id="rec-step1">
                <input type="text" id="rec-user-find" placeholder="Seu Usu√°rio">
                <button class="auth-btn" onclick="findUser()">Ver Pergunta</button>
            </div>
            <div id="rec-step2" class="hidden">
                <p id="display-phrase" style="font-weight:bold; color:var(--p)"></p>
                <input type="text" id="rec-ans-check" placeholder="Sua Resposta">
                <input type="password" id="rec-new-pass" placeholder="Nova Senha">
                <button class="auth-btn" onclick="execRec()">Redefinir</button>
            </div>
            <p onclick="location.reload()" style="cursor:pointer; font-size:12px; margin-top:15px">Cancelar</p>
        </div>
    </div>

    <div id="app" class="hidden">
        <div class="col-1 no-print">
            <div style="padding:15px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center;">
                <span style="font-weight:bold; font-size:12px">LUCIMEIRI üë†</span>
                <button onclick="execSair()" style="background:rgba(255,255,255,0.1); color:#fff; border:1px solid rgba(255,255,255,0.3); padding:4px 8px; border-radius:5px; cursor:pointer; font-size:10px">SAIR</button>
            </div>
            <select id="sel-turno" onchange="mudarTurno()" class="turno-select">
                <option value="Matutino">‚òÄÔ∏è Matutino</option>
                <option value="Vespertino">üå§Ô∏è Vespertino</option>
                <option value="Noturno">üåô Noturno</option>
            </select>
            <div style="padding:10px"><button onclick="addTurma()" class="btn-add" style="width:100%; background:white; color:var(--sidebar)">+ Turma</button></div>
            <div id="lista-turmas" style="flex:1; overflow-y:auto"></div>
            <div style="padding:10px; border-top:1px solid rgba(255,255,255,0.1)">
                <button onclick="fazerBackup()" class="btn-bkp" style="width:90%">üíæ Fazer Backup</button>
                <button onclick="document.getElementById('input-bkp').click()" class="btn-bkp" style="width:90%">üìÇ Restaurar Dados</button>
                <input type="file" id="input-bkp" class="hidden" onchange="restaurarBackup(this)">
            </div>
        </div>
        <div class="col-2 no-print">
            <div style="padding:15px; border-bottom:1px solid #f8bbd0">
                <button onclick="addAluno()" class="btn-add" style="width:100%; margin-bottom:10px">CADASTRAR ALUNO</button>
                <div style="width:100%"><input type="text" id="busca" placeholder="Filtrar aluno..." onkeyup="filtrar()"></div>
            </div>
            <div id="lista-alunos" style="overflow-y:auto; flex:1"></div>
        </div>
        <div class="col-3" id="print-area">
            <div id="topo-notas" class="hidden header-main no-print">
                <div style="display:flex; align-items:center; gap:10px">
                    <b id="nome-aluno-header" style="color: var(--sidebar); font-size: 14px"></b>
                    <select id="sel-mat" onchange="renderNotas()" style="padding:6px; border-radius:8px; border:1px solid #f8bbd0; font-weight:700; color: var(--p)"></select>
                    <button onclick="addMateria()" class="btn-add">+ MAT</button>
                    <button onclick="delMateria()" style="background:none; border:none; color:var(--err); cursor:pointer; font-size:18px">üóëÔ∏è</button>
                </div>
                <div id="mat-display-topo" style="flex:1; text-align:center; font-weight:900; color:var(--sidebar); font-size:16px"></div>
                <div style="display:flex; gap:10px">
                    <button onclick="window.print()" style="background:#000; color:#fff; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; font-weight:800; font-size:11px">IMPRIMIR</button>
                </div>
            </div>
            <div id="workspace-notas" class="hidden" style="flex:1; display:flex; flex-direction:column">
                <div class="grid-bim no-print" id="grid-notas"></div>
                <div id="boletim-impresso"></div>
                <div class="no-print" style="padding:20px; background:#fff; border-top:1px solid #f8bbd0; text-align:right">
                    <div id="total-anual-txt" style="font-weight:800; font-size: 22px; color: var(--sidebar)"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    let db = JSON.parse(localStorage.getItem('edu_db_vfinal_lucimeiri')) || { turmas: [], auth: null };
    let cur = { t: null, a: null };
    const save = () => localStorage.setItem('edu_db_vfinal_lucimeiri', JSON.stringify(db));
    
    function showAuth(id) { document.querySelectorAll('.auth-card').forEach(c => c.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    
    function execReg() {
        const u=document.getElementById('r-user').value, p=document.getElementById('r-pass').value, f=document.getElementById('r-phrase').value, a=document.getElementById('r-ans').value;
        
        if(db.auth && u === db.auth.u) {
            alert("Este usu√°rio j√° est√° cadastrado! ‚ù§Ô∏èüë†");
            showAuth('auth-login');
            return;
        }

        if(u && p) { db.auth={u,p,f,a}; save(); alert("Cadastro realizado com sucesso! ‚ù§Ô∏è"); showAuth('auth-login'); }
    }
    
    function execLogin() {
        const u=document.getElementById('l-user').value, p=document.getElementById('l-pass').value;
        if(db.auth && u===db.auth.u && p===db.auth.p) { 
            alert("Bem-vinda, Lucimeiri! ‚ù§Ô∏è");
            document.getElementById('auth-screen').classList.add('hidden'); 
            document.getElementById('app').classList.remove('hidden'); 
            renderTurmas();
        } else alert("Acesso Negado.");
    }

    function findUser() {
        const u = document.getElementById('rec-user-find').value;
        if(db.auth && u === db.auth.u) {
            document.getElementById('display-phrase').innerText = "Pergunta: " + db.auth.f;
            document.getElementById('rec-step1').classList.add('hidden');
            document.getElementById('rec-step2').classList.remove('hidden');
        } else { alert("Usu√°rio n√£o encontrado!"); }
    }

    function execRec() {
        const ans = document.getElementById('rec-ans-check').value;
        const newP = document.getElementById('rec-new-pass').value;
        if(db.auth && ans.toLowerCase() === db.auth.a.toLowerCase()) {
            db.auth.p = newP; save();
            alert("Senha redefinida!"); location.reload();
        } else { alert("Resposta incorreta!"); }
    }

    function execSair() { alert("Nunca esque√ßa o quanto voc√™ √© especial ‚ù§Ô∏è!"); location.reload(); }

    function limparTelaTotal() {
        cur.a = null;
        document.getElementById('lista-alunos').innerHTML = '';
        document.getElementById('topo-notas').classList.add('hidden');
        document.getElementById('workspace-notas').classList.add('hidden');
    }

    function mudarTurno() { cur.t = null; limparTelaTotal(); renderTurmas(); }

    function addTurma() { 
        const n=prompt("Nome da Turma:"); 
        if(n) { 
            db.turmas.push({nome:n, turno:document.getElementById('sel-turno').value, materias:[], alunos:[]}); 
            save(); limparTelaTotal(); renderTurmas(); 
        } 
    }
    
    function renderTurmas() {
        const t=document.getElementById('sel-turno').value, div=document.getElementById('lista-turmas'); div.innerHTML='';
        db.turmas.filter(tr => tr.turno === t).sort((a,b) => a.nome.localeCompare(b.nome, undefined, {numeric:true})).forEach((tr) => { 
            const idx = db.turmas.indexOf(tr);
            div.innerHTML+=`<div class="turma-badge ${cur.t===idx?'active':''}" onclick="setTurma(${idx})"><span>${tr.nome}</span><span onclick="delTurma(${idx}, event)" style="color:#ff8a80; font-weight:bold; padding-left:10px">√ó</span></div>`; 
        });
    }

    function setTurma(i) { cur.t=i; cur.a=null; 
        document.getElementById('topo-notas').classList.add('hidden');
        document.getElementById('workspace-notas').classList.add('hidden');
        renderTurmas(); renderAlunos(); 
    }

    function delTurma(idx, event) {
        event.stopPropagation();
        if(confirm("Excluir esta TURMA?")) { db.turmas.splice(idx, 1); cur.t=null; limparTelaTotal(); save(); renderTurmas(); }
    }

    function addAluno() { 
        if(cur.t === null) return alert("Selecione uma TURMA!");
        const n=prompt("Nome do Aluno:"); if(n) { db.turmas[cur.t].alunos.push({nome:n, notas:{}}); save(); renderAlunos(); } 
    }

    function delAluno(idx, event) {
        event.stopPropagation();
        if(confirm("Excluir aluno?")) { 
            db.turmas[cur.t].alunos.splice(idx, 1); cur.a=null; 
            document.getElementById('topo-notas').classList.add('hidden');
            document.getElementById('workspace-notas').classList.add('hidden');
            save(); renderAlunos(); 
        }
    }

    function renderAlunos() {
        const div=document.getElementById('lista-alunos'); div.innerHTML=''; if(cur.t===null) return;
        db.turmas[cur.t].alunos.sort((a,b) => a.nome.localeCompare(b.nome)).forEach((al) => { 
            const idx = db.turmas[cur.t].alunos.indexOf(al);
            div.innerHTML+=`<div class="aluno-card ${cur.a===idx?'active':''}" onclick="setAluno(${idx})"><span>${al.nome.toUpperCase()}</span><span onclick="delAluno(${idx}, event)" style="color:var(--err)">üóëÔ∏è</span></div>`; 
        });
    }

    function setAluno(i) { cur.a=i; document.getElementById('nome-aluno-header').innerText=db.turmas[cur.t].alunos[i].nome; document.getElementById('topo-notas').classList.remove('hidden'); document.getElementById('workspace-notas').classList.remove('hidden'); renderAlunos(); atualizarMaterias(); }
    
    function addMateria() { const n=prompt("Mat√©ria:"); if(n) { db.turmas[cur.t].materias.push(n); save(); atualizarMaterias(); } }
    
    function atualizarMaterias() { 
        const sel=document.getElementById('sel-mat'); 
        const mats = db.turmas[cur.t].materias.sort((a,b) => a.localeCompare(b));
        sel.innerHTML = mats.map(m=>`<option value="${m}">${m}</option>`).join('');
        if(mats.length > 0) renderNotas();
        else { document.getElementById('workspace-notas').classList.add('hidden'); document.getElementById('mat-display-topo').innerText = ""; }
    }
    
    function delMateria() { 
        const m = document.getElementById('sel-mat').value;
        if(!m) return;
        if(confirm(`Excluir a mat√©ria "${m}"?`)) { 
            db.turmas[cur.t].materias = db.turmas[cur.t].materias.filter(x => x !== m); 
            save(); atualizarMaterias(); 
        } 
    }
    
    function renderNotas() {
        const m=document.getElementById('sel-mat').value; 
        if(!m) { document.getElementById('workspace-notas').classList.add('hidden'); return; }
        document.getElementById('workspace-notas').classList.remove('hidden');
        document.getElementById('mat-display-topo').innerText = m.toUpperCase();
        const al=db.turmas[cur.t].alunos[cur.a]; let total=0; document.getElementById('grid-notas').innerHTML='';
        for(let b=1; b<=4; b++) {
            const key=`${m}_b${b}`, notas=al.notas[key] || []; const soma=notas.reduce((s,n)=>s+parseFloat(n.v),0); total+=soma;
            document.getElementById('grid-notas').innerHTML+=`<div class="card-bim"><b>${b}¬∫ BIM</b> <button onclick="addNota('${key}')" class="btn-add">+</button><div style="font-size:12px; margin:10px 0; height:60px; overflow-y:auto">${notas.map((n, ni)=>`<div>${n.d}: ${n.v} <i onclick="delNota('${key}',${ni})" style="color:red; cursor:pointer">x</i></div>`).join('')}</div><div style="text-align:right; font-weight:800; color:var(--p)">SOMA: ${soma.toFixed(1)}/25</div></div>`;
        }
        document.getElementById('total-anual-txt').innerText=`TOTAL: ${total.toFixed(1)} / 100`;
        prepararBoletim();
    }

    function addNota(key) {
        const al=db.turmas[cur.t].alunos[cur.a]; if(!al.notas[key]) al.notas[key]=[]; 
        const soma=al.notas[key].reduce((s,n)=>s+parseFloat(n.v),0);
        const d=prompt("Avalia√ß√£o:"); const v=parseFloat(prompt("Nota:"));
        if(d && !isNaN(v)) { if((soma+v) <= 25.1) { al.notas[key].push({d, v}); save(); renderNotas(); } else alert("Limite de 25 pontos!"); }
    }
    function delNota(key, ni) { if(confirm("Excluir nota?")) { db.turmas[cur.t].alunos[cur.a].notas[key].splice(ni,1); save(); renderNotas(); } }
    
    function filtrar() { const v=document.getElementById('busca').value.toLowerCase(); document.querySelectorAll('.aluno-card').forEach(e=> { e.style.display = e.innerText.toLowerCase().includes(v) ? 'flex' : 'none'; }); }

    function fazerBackup() {
        const dados = JSON.stringify(db); const blob = new Blob([dados], { type: 'text/plain' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
        a.download = `backup_diario_lucimeiri_${new Date().toLocaleDateString().replace(/\//g,'-')}.txt`; a.click();
    }

    function restaurarBackup(input) {
    const arquivo = input.files[0]; 
    if (!arquivo) return;
    const leitor = new FileReader();
    leitor.onload = (e) => {
        try { 
            const novosDados = JSON.parse(e.target.result);
            
            // Mant√©m o usu√°rio atual logado (n√£o sobrescreve o auth atual se ele existir)
            if (db.auth) novosDados.auth = db.auth;
            
            db = novosDados;
            save(); 
            
            // Em vez de reload total, apenas reseta a vis√£o das turmas
            limparTelaTotal();
            renderTurmas();
            alert("Dados Restaurados com Sucesso! ‚ù§Ô∏è"); 
        } catch(err) { 
            alert("Erro ao ler o arquivo de backup!"); 
        }
    };
    leitor.readAsText(arquivo);
}


    function prepararBoletim() {
        const al = db.turmas[cur.t].alunos[cur.a], tr = db.turmas[cur.t];
        let html = `<div style="text-align:center"><h2>BOLETIM - ${al.nome.toUpperCase()}</h2><p>TURMA: ${tr.nome} | PROFESSORA: LUCIMEIRI</p></div><table style="width:100%; border-collapse:collapse"><thead><tr><th style="border:1px solid #000">MAT√âRIA</th><th style="border:1px solid #000">1¬∫B</th><th style="border:1px solid #000">2¬∫B</th><th style="border:1px solid #000">3¬∫B</th><th style="border:1px solid #000">4¬∫B</th><th style="border:1px solid #000">TOTAL</th><th style="border:1px solid #000">SITUA√á√ÉO</th></tr></thead><tbody>`;
        tr.materias.forEach(m => {
            const b1=(al.notas[m+'_b1']||[]).reduce((s,n)=>s+parseFloat(n.v),0), b2=(al.notas[m+'_b2']||[]).reduce((s,n)=>s+parseFloat(n.v),0), b3=(al.notas[m+'_b3']||[]).reduce((s,n)=>s+parseFloat(n.v),0), b4=(al.notas[m+'_b4']||[]).reduce((s,n)=>s+parseFloat(n.v),0), total = b1+b2+b3+b4;
            html += `<tr><td style="border:1px solid #000; padding:5px">${m.toUpperCase()}</td><td style="border:1px solid #000; text-align:center">${b1.toFixed(1)}</td><td style="border:1px solid #000; text-align:center">${b2.toFixed(1)}</td><td style="border:1px solid #000; text-align:center">${b3.toFixed(1)}</td><td style="border:1px solid #000; text-align:center">${b4.toFixed(1)}</td><td style="border:1px solid #000; text-align:center"><b>${total.toFixed(1)}</b></td><td style="border:1px solid #000; text-align:center">${total>=70?'APROVADO':'REPROVADO'}</td></tr>`;
        });
        document.getElementById('boletim-impresso').innerHTML = html + `</tbody></table>`;
    }

    window.onload = () => { showAuth('auth-login'); };
</script>
</body>
</html>



